<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="This guide will walk through the process of pulling and analyzing court data from the OJO databse.
">
<title>Pulling court data with ojodb • ojodb</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pulling court data with ojodb">
<meta property="og:description" content="This guide will walk through the process of pulling and analyzing court data from the OJO databse.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ojodb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.5.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette-connecting-to-ojo.html">Connecting to ojodb</a>
    <a class="dropdown-item" href="../articles/vignette-pulling-data.html">Pulling court data with ojodb</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Pulling court data with ojodb</h1>
            
      
      
      <div class="d-none name"><code>vignette-pulling-data.Rmd</code></div>
    </div>

    
    
<p><a href="https://www.oscn.net/v4/" class="external-link"><img src="images/oscn-screenshot.png" alt="A screenshot of the OSCN homepage"></a></p>
<div class="section level2">
<h2 id="intro-the-ojo-database">Intro: The OJO database<a class="anchor" aria-label="anchor" href="#intro-the-ojo-database"></a>
</h2>
<p>Many of our projects and requests involve pulling court data from our
OJO database. There are a few other organizations and authorities who
have collected this type of data in Oklahoma, but we’re somewhat unique
in the amount of data we have and the tools we’ve developed to pull and
analyze it.</p>
<p>Our court data comes from two sources:</p>
<ul>
<li><p>The <a href="https://www.oscn.net/v4/" class="external-link">Oklahoma State Court
Network website</a>, the official record for the most populous and
organized counties in the state, and</p></li>
<li><p>The <a href="https://www1.odcr.com/" class="external-link">On Demand Court Records
website</a>, an alternate official record used by the less populous
counties.</p></li>
</ul>
<p>We scrape the data posted on these websites each day, and store the
contents in our database.</p>
<p>Having the data scraped and wrangled like this lets us answer
questions that are harder to get a handle on otherwise. For example,
legislators and stakeholders will often want to know things like “How
many felonies were filed from 2016-2022?”, or “How did eviction filings
change during COVID, or as a result of X policy change?” It can be
shockingly hard to answer even basic questions like that, even for
government officials, and that’s where our database comes in!</p>
<p>To get an idea of how to use the database to answer these kinds of
questions, this vignette will walk through all the steps for a
hypothetical research question.</p>
<div class="section level3">
<h3 id="research-question">Research Question:<a class="anchor" aria-label="anchor" href="#research-question"></a>
</h3>
<blockquote>
<p>How many misdemeanor cases involving drugs were filed in Oklahoma and
Tulsa county in each month from 2016-2022?</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="before-you-proceed">Before you proceed:<a class="anchor" aria-label="anchor" href="#before-you-proceed"></a>
</h3>
<p>This vignette assumes that A) you’ve already installed
<code>{ojodb}</code>, and B) your credentials and access to the database
are properly configured – most of the <code>{ojodb}</code> functions
won’t work if not. It can be a bit tricky to get working, so please ask
for help if you have any issues!</p>
<!-- For more information on how to get everything set up, see `vignette("vignette-connecting-to-ojo")`. -->
</div>
</div>
<div class="section level2">
<h2 id="step-1-getting-the-lay-of-the-land">Step 1: Getting the lay of the land<a class="anchor" aria-label="anchor" href="#step-1-getting-the-lay-of-the-land"></a>
</h2>
<p>Just for educational purposes, we’ll start by taking a look around
database and seeing exactly where the court data lives.</p>
<p>Our database is divided into a few “schemas” – if our database is a
big filing cabinet, we can imagine the schemas as separate drawers. You
can see all of them using the <code><a href="../reference/ojo_list_schemas.html">ojo_list_schemas()</a></code>
function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ojodb</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ojo_list_schemas.html">ojo_list_schemas</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 1</span></span></span>
<span><span class="co">#&gt;   schema            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> archive           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> doc_tracker       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> eviction_addresses</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> eviction_dashboard</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> iic               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ocdc              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> odoc              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> public</span></span></code></pre></div>
<p>Each schema, generally speaking, relates to one of our data types /
topics / policy areas. Each one contains tables that store data related
to that policy area. Among others, we have:</p>
<ul>
<li><p>a schema for <code>ocdc</code> (Oklahoma County Detention Center,
i.e. the jail in Oklahoma City),</p></li>
<li><p>another one for <code>odoc</code> (Oklahoma Department of
Corrections, i.e. Oklahoma state prisons),</p></li>
<li><p>another for <code>eviction_addresses</code> (this one contains
data related to a specific eviction-related project)</p></li>
</ul>
<center>
<div class="float">
<img src="images/object-hierarchy.png" alt="A diagram I found online that shows how our database is structured."><div class="figcaption">A diagram I found online that shows how our
database is structured.</div>
</div>
</center>
<p>The court data that we’re interested in right now is stored in the
default schema, <code>public</code>. Let’s open the “drawer” and see
what kind of data is inside.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ojo_list_tables.html">ojo_list_tables</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="st">"public"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 18 × 2</span></span></span>
<span><span class="co">#&gt;    schema table           </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> public appellate_count </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> public case            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> public representation  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> public citation        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> public minute          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> public issue           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> public exception_log   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> public party           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> public attorney_address</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> public count           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> public migrations      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> public person_record   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> public marital_status  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> public attorney        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> public case_type       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> public event           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> public address         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> public process_log</span></span></code></pre></div>
<p>If a schema is a drawer in our filing cabinet, then tables are the
folders inside. The <code>public</code> schema contains several
different tables, all of which relate back to our court data. Here are
the most important ones to know:</p>
<ul>
<li><p>The <code>case</code> table contains the basic information about
each case. This includes variables like the case number, the date it was
filed, the judge it was assigned to, etc. It also includes ID columns
that allow you to join it with the other tables in this schema in order
to see things like the defendant’s name and DOB, attorneys involved,
etc. Each row is one <strong>case</strong>.</p></li>
<li><p>The <code>count</code> table contains the individual charges
filed in each case; most cases involve more than one. Each row is one
<strong>charge</strong>.</p></li>
<li><p>The <code>minute</code> table contains the court minutes for each
case. This is where we get data about court fines and fees, among many
other things. There are a ton of minutes per case, so working with the
minute data often means having to spend a lot of time waiting for data
to download. Each row is one <strong>court minute</strong>.</p></li>
</ul>
<p>We can see exactly which variables are included in each table using
the <code><a href="../reference/ojo_list_vars.html">ojo_list_vars()</a></code> function. For example, let’s take a
closer look at the main <code>case</code> table:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ojo_list_vars.html">ojo_list_vars</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="st">"public"</span>, table <span class="op">=</span> <span class="st">"case"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [?? x 1]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: postgres  [bgregory@34.122.10.67:5432/ojodb]</span></span></span>
<span><span class="co">#&gt;    column_name</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> id         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> title      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> district   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> case_type  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> year       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> case_number</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> date_filed </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> date_closed</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> status     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> judge      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ Use `print(n = ...)` to see more rows</span></span></span></code></pre></div>
<p>We’re interested in criminal cases right now, so we’ll be pulling
data from this table for our example research question.</p>
<!-- ### One more note: -->
<!-- You'll notice that the `case` table includes most of the things you'd expect -- the filing district, year, case type, etc. However, you might be wondering why there are also columns for things like `minutes` and `issues` -- as we just saw, this information is actually stored in a separate table within the `public` schema. The answer is that these columns aren't storing the data in and of themselves; instead, they contain keys that we can use to join the `case` table with the others. -->
<!-- For example, let's take a look at what these columns look like in the first five rows of the `case` table, using the `ojo_tbl()` function: -->
<!-- ```{r} -->
<!-- first_five <- ojo_tbl(schema = "public", table = "case") |> -->
<!--  head() |> -->
<!--  collect() |> -->
<!--  select(id, minutes, counts) -->
<!-- first_five$id -->
<!-- first_five$counts -->
<!-- first_five$minutes -->
<!-- ``` -->
<!-- As you can see, these columns look a bit different, and don't store any data themselves. Instead, they contain *array* variables that we can use to join the `case` table to the `counts` and `minutes` tables as needed. Joining tables will be discussed more later, and our helper functions mean that we shouldn't have to think about this stuff outside of unusual circumstances. -->
<!-- To be clear, it's not crucial that you become an expert on database systems or anything like that. It is only mentioned here because it can be pretty confusing if you're new to databases. -->
</div>
<div class="section level2">
<h2 id="step-2-pulling-our-data-ojo_crim_cases">Step 2: Pulling our data – <code>ojo_crim_cases()</code><a class="anchor" aria-label="anchor" href="#step-2-pulling-our-data-ojo_crim_cases"></a>
</h2>
<p>Now that we understand the basic layout of the database, we can start
pulling the data we’re interested in! Fortunately, we have helper
functions that save us from having to think too much about schemas and
tables in our daily work.</p>
<p>Keeping our research question in mind, we’ll start by pulling all the
<strong>misdemeanor criminal cases</strong> filed in <strong>Oklahoma
and Tulsa counties</strong> from <strong>2016-2022</strong>. We’ll use
one of our helper functions, <code><a href="../reference/ojo_crim_cases.html">ojo_crim_cases()</a></code>, to do so. It
first queries the <code>case</code> table, then combines that table of
<strong>cases</strong> with each case’s <strong>charges</strong> from
the <code>count</code> table.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This function combines the "case" and "count" tables in our database,</span></span>
<span><span class="co"># and returns a cleaned dataframe where each row is one charge in a case.</span></span>
<span><span class="va">charge_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ojo_crim_cases.html">ojo_crim_cases</a></span><span class="op">(</span>districts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OKLAHOMA"</span>, <span class="st">"TULSA"</span><span class="op">)</span>,</span>
<span>                              case_types <span class="op">=</span> <span class="st">"CM"</span>, <span class="co"># "CM" is short for "criminal misdemeanor"</span></span>
<span>                              file_years <span class="op">=</span> <span class="fl">2016</span><span class="op">:</span><span class="fl">2022</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># you can add things like filter(), select(), etc. here</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> function we’re using is from the
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> package. Our helper function
<code><a href="../reference/ojo_crim_cases.html">ojo_crim_cases()</a></code> uses the provided arguments to put
together a query to our database, and the <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code>
function executes that query and returns the result as a lazy tibble
into your R environment. If we wanted to, we could add in additional
filtering, sorting, etc. by adding <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> functions like
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code>, etc. before the
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> call. But for now, we want to see everything.</p>
<div class="section level3">
<h3 id="exploring-the-data-weve-pulled">Exploring the data we’ve pulled<a class="anchor" aria-label="anchor" href="#exploring-the-data-weve-pulled"></a>
</h3>
<p>Now we’ve got our data saved as the object <code>charge_data</code>,
nice! Before we do anything else, let’s start by taking a look at our
dataframe in RStudio using the <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code> function (or just by
clicking on it in your RStudio “Data” panel).</p>
<center>
<div class="float">
<img src="images/view-case-data.png" alt="The result of View(charge_data)"><div class="figcaption">The result of View(charge_data)</div>
</div>
</center>
<!-- You'll probably notice those array columns like `id` and `counts` are still present; `ojo_crim_cases()` used them behind the scenes to join the charge data onto the case data, but we can more or less ignore those now since we're not using them in our analysis. -->
</div>
<div class="section level3">
<h3 id="charges-vs--cases">Charges vs. Cases?<a class="anchor" aria-label="anchor" href="#charges-vs--cases"></a>
</h3>
<p>You’ll probably notice that our dataframe includes data on the
individual charges in each case, stored in <code>count_as_filed</code>
and <code>disposition</code>. As discussed above, there’s often going to
be more than one charge involved in a given case, which means that we
should note that our data is in terms of <strong>charges</strong>, not
<strong>cases</strong>. Let’s start by seeing how many of each we have
here:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many total charges? ------------------------------------------------------</span></span>
<span><span class="co"># The data are already in terms of charges (1 charge per row), so we can simply</span></span>
<span><span class="co"># count the rows.</span></span>
<span><span class="va">charge_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 111200</span></span>
<span></span>
<span><span class="co"># How many total cases? --------------------------------------------------------</span></span>
<span><span class="co"># There's more than one charge per case sometimes, so we need to see how many</span></span>
<span><span class="co"># unique cases there are total. Here are two possible approaches:</span></span>
<span></span>
<span><span class="co"># Approach #1: Creating a new, unique district + case_number variable</span></span>
<span><span class="va">charge_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Case numbers are unique within districts; </span></span>
<span>  <span class="co"># e.g. Tulsa's CM-2023-001 is a different case than Oklahoma's CM-2023-001.</span></span>
<span>  <span class="co"># We can create a new variable that will always be unique -- district + case_number</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>case_number_with_district <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">district</span>, <span class="va">case_number</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">case_number_with_district</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 62186</span></span>
<span></span>
<span><span class="co"># This approach returns the number of unique case_number / district combinations, </span></span>
<span><span class="co"># but not much else.</span></span>
<span></span>
<span><span class="co"># Approach 2: Making a new summary dataset with group_by() + summarize()</span></span>
<span><span class="va">case_summary</span> <span class="op">&lt;-</span> <span class="va">charge_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">district</span>, <span class="va">case_number</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    n_charges <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="co"># Note: if you want, you can add further summary variables here. </span></span>
<span>    <span class="co"># For example, maybe you want to know how many charges in each case led to</span></span>
<span>    <span class="co"># a conviction. You could do something like this:</span></span>
<span>    <span class="co"># n_convictions = sum(disposition == "CONVICTION", na.rm = T)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">case_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 62186</span></span>
<span></span>
<span><span class="co"># This tells us the number, and also leaves us with a helpful new case_summary</span></span>
<span><span class="co"># dataset that we can use later on, if we want to know more.</span></span></code></pre></div>
<p>It looks like <code>charge_data</code> includes 111,200 rows. In
other words, our data shows that there were 111,200 total
<strong>charges</strong> filed in Oklahoma and Tulsa county misdemeanor
cases from 2016-2022.</p>
<p>On the other hand, it looks like there are 62,186 unique combinations
of <code>district</code> and <code>case_number</code> (and an equal
number of rows in our new summary dataframe, <code>case_summary</code>).
In other words, our data shows 62,186 total misdemeanor
<strong>cases</strong> filed in Oklahoma and Tulsa county from
2016-2022.</p>
<p>If we wanted to, we could divide those numbers (or use our handy
<code>case_summary</code> dataframe) to see the average number of
charges per case:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Total charges / total cases = Avg. number of charges per case</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">charge_data</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">case_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.788184</span></span>
<span></span>
<span><span class="co"># Different approach, same thing</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">case_summary</span><span class="op">$</span><span class="va">n_charges</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.788184</span></span></code></pre></div>
<p>It seems there’s an average of 1.79 counts per misdemeanor case in
this dataset. Neat!</p>
<p>It’s very helpful to always be thinking about what the rows in your
data represent. Keeping track of what exactly you’re looking at
(charges, cases, defendants, etc.) can be one of the most challenging
parts of these analyses, especially when our client isn’t exactly sure
which they want to know about.</p>
</div>
<div class="section level3">
<h3 id="did-we-get-everything-we-asked-for">Did we get everything we asked for?<a class="anchor" aria-label="anchor" href="#did-we-get-everything-we-asked-for"></a>
</h3>
<p>Though we have data coverage and quality checks already as part of
our scrapers and database, court data is always extremely messy, which
can lead to unforeseen issues. Knowing this, it’s usually a good idea to
double check your data after you’ve pulled it in order to ensure
<code><a href="../reference/ojo_crim_cases.html">ojo_crim_cases()</a></code> returned all the data you requested.</p>
<p>We should at least check the data <strong>geographically</strong> and
<strong>temporally</strong>; in other words, we should make sure there
aren’t any weird, unexpected differences between counties or between
filing years / months. How exactly you do this due diligence is up to
you, but one potential approach is to make a quick visualization or two.
For example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We're going to look at charges, not cases here</span></span>
<span><span class="va">charge_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Our end goal is to see monthly filings, so we'll use that same timeframe</span></span>
<span>    month_filed <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">date_filed</span>, <span class="st">"months"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">district</span>, <span class="va">month_filed</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Our two most important checks, geography and time</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">month_filed</span>,</span>
<span>             y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># I'm choosing geom_col() over geom_line() because I want to see any gaps clearly</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">district</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Total charges filed per month in CM cases"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette-pulling-data_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>This graph looks pretty much as we’d expect it to – there’s not a
huge difference between Oklahoma and Tulsa counties (which makes sense,
given that they’re similar in size), and there aren’t any conspicuously
missing months, suspiciously massive and sudden spikes / drops, etc. And
while there is a lot of variation (particularly in Oklahoma county),
there’s nothing that looks suspicious enough for me to suspect a data
issue.</p>
<p>It would be great if there was an absolute source of truth that we
could use to double check this stuff more reliably. An internal data
quality monitoring dashboard that serves this purpose is on our list of
goals, and hopefully that will serve as an easy reference point in the
future. But for now, this part of the process is all about looking at
the data from different angles and thinking critically about where you
might run into potential issues, and how those issues might show up in
your testing. Referencing past OKPI work is also another good option,
and so is asking another analyst who is more familiar with the data in
that area.</p>
</div>
<div class="section level3">
<h3 id="back-to-our-research-question">Back to our research question<a class="anchor" aria-label="anchor" href="#back-to-our-research-question"></a>
</h3>
<p>Now we’ve got a big dataset of all the charges we care about
(<code>charge_data</code>) and another big dataset of all the cases we
care about (<code>case_summary</code>), we’ve familiarized ourselves
with what they look like and what they mean, and we’ve double checked
that the data are all there. Let’s revisit our research question now to
see what cleaning and wrangling we need to do in order to finish
answering it.</p>
<blockquote>
<p>How many <strong>misdemeanor cases</strong> involving
<strong>drugs</strong> were filed in <strong>Oklahoma and Tulsa
county</strong> in <strong>each month</strong> from
<strong>2016-2022</strong>?</p>
</blockquote>
<p>We’ve got the “misdemeanor cases filed in Oklahoma and Tulsa county
from 2016-2022” part down, but we’re still missing a few things.
Namely,</p>
<ul>
<li><p>we still need to filter our data to include only cases involving
drugs, and</p></li>
<li><p>we still need to calculate the number of cases filed per month in
this timespan.</p></li>
</ul>
<p>We’ll move on to those steps next.</p>
</div>
</div>
<div class="section level2">
<h2 id="step-3-wrangling-cleaning-and-analyzing-the-data">Step 3: Wrangling, cleaning, and analyzing the data<a class="anchor" aria-label="anchor" href="#step-3-wrangling-cleaning-and-analyzing-the-data"></a>
</h2>
<div class="section level3">
<h3 id="searching-for-drug-related-charges">Searching for drug-related charges<a class="anchor" aria-label="anchor" href="#searching-for-drug-related-charges"></a>
</h3>
<p>First, we’ll need to limit our dataset to cases involving drugs. But
what exactly does that mean? Do we want any kind of case at all where at
least one of the charges was drug-related, or only cases where
<em>all</em> the charges were drug related? What exactly do we count as
“drug-related” charges, anyway? Frequently, our partners will make vague
asks like this and leave it to us to answer those questions.</p>
<p>You’ll also notice that the data in the <code>count_as_filed</code>
column is very messy, and we won’t be able to do something as simple as
<code>filter(count_as_filed == "Drug Possession")</code>. So we’ll need
to find a way of parsing that text in order to find the charges we
need.</p>
<p>The answers to these methodology questions will depend on the exact
task at hand, but our goal is to make our research methodology as
standardized and replicable as possible. That also means we don’t want
to re-invent the wheel – Open Justice Oklahoma has done lots of work on
drug laws in the past, and so we have a fairly well established way of
searching the statutes for relevant charges. Here are some of the places
you can go to see how OJO has handled methodology / data issues in the
past:</p>
<ul>
<li>The <a href="https://stackoverflowteams.com/c/oklahoma-policy-institute/questions" class="external-link"><strong>Oklahoma
Policy Institute Stack Overflow site</strong></a> has a Q/A format like
the Stack Overflow we all know and love. If you run into a new issue we
don’t have documented here, feel free to add your own questions /
answers as needed!</li>
<li>Searching the <a href="https://github.com/openjusticeok" class="external-link"><strong>Open Justice Oklahoma
Github repos</strong></a> for keywords can sometimes turn up past work,
especially when you’re dealing with a more technical coding issue.</li>
<li>The <a href="https://okpolicy.org/category/ok-policy-blog/" class="external-link"><strong>Oklahoma
Policy Institute blog page</strong></a> has finished products we’ve
helped put out in the past, with work on evictions, drug laws, felony
reclassification, fines and fees, etc.</li>
<li>And, of course, please don’t hesitate to ask on
<strong>Slack</strong>! It’s easy for things to get lost in the shuffle
and not make it into documentation anywhere, and despite our efforts,
there are still a lot of things that only live inside someone’s
brain.</li>
</ul>
<p>In this case, we’re going to use a regex string that OJO’s founder
Ryan Gentzler originally wrote to find any kind of drug-related charge,
including things like paraphernalia, trafficking, etc. Here’s the
string:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drugs</span> <span class="op">&lt;-</span> <span class="st">"CDS|C\\.D\\.S|DRUG|OXY|HUFF|AMPHET|ZOLOL|ZOLAM|HYDROC|CODEIN|PRECURS|</span></span>
<span><span class="st">|XANAX|MORPH|METERDI|ZEPAM|LORAZ|VALIU|EPHED|SUB|COCA|PSEUDO| CD|CD |PRESCRIP|</span></span>
<span><span class="st">|NARC|METH|C\\.D\\.|HEROIN|ANHYD|AMMONIA|OPIUM|LORTAB|MARIJUANA|CANNABIS|MJ"</span></span></code></pre></div>
<p>While I was writing this vignette, I found it by searching “drugs”
and “marijuana” on our Github. It should really be a lot easier and more
streamlined than that, though, so in the future this will hopefully be
integrated as part of the <code>{ojodb}</code> package.</p>
<p>We’ll start by adding a new variable that simply classifies each
charge as drug-related or not.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We'll save it as a new dataframe, charge_data_cleaned</span></span>
<span><span class="va">charge_data_cleaned</span> <span class="op">&lt;-</span> <span class="va">charge_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">counts</span>, <span class="va">open_counts</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># We don't need every column, so let's drop the extras</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    drug_charge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="va">drugs</span>, <span class="co"># Do any of our "drug" strings...</span></span>
<span>                        x <span class="op">=</span> <span class="va">count_as_filed</span>, <span class="co"># ...show up in count_as_filed?</span></span>
<span>                        ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># ignore.case is important!</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Note the inclusion of <code>ignore.case = TRUE</code>! Although most
of the data in the <code>count_as_filed</code> column is in uppercase,
you shouldn’t assume <strong>anything</strong> in this court data will
be uniform. Much of it is hand-entered by the county clerks, and there
are frequent typos, differences in phrasing between districts, random
lowercase entries, etc. It is <em>very</em> messy, which means we have
to be vigilant when it comes to double-checking our work and not making
too many assumptions about the data.</p>
<p>Again, let’s stop and check to make sure the result looks as we
expect it to.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">charge_data_cleaned</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">district</span>, <span class="va">case_number</span>, <span class="va">count_as_filed</span>, <span class="va">drug_charge</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">drug_charge</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># We'll just look at a random sample of 10 in each category</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   drug_charge [2]</span></span></span>
<span><span class="co">#&gt;    district case_number  count_as_filed                                  drug_…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                           <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> OKLAHOMA CM-2021-2514 OBS, OBSTRUCTING AN OFFICER                     FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> OKLAHOMA CM-2016-2037 DR1, BEING INTOXICATED IN A PUBLIC PLACE        FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> TULSA    CM-2022-2478 RES, RESISTING AN OFFICER                       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> OKLAHOMA CM-2017-1981 ABDOM, DOMESTIC ABUSE ( ASSAULT &amp; BATTERY)      FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> TULSA    CM-2021-3589 S11, SPEEDING - POSTED ZONE                     FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> OKLAHOMA CM-2019-3781 BH, THREATENING TO PERFORM AN ACT OF VIOLENCE   FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> TULSA    CM-2020-4220 RCSP, RECEIVE, POSSESS OR CONCEAL STOLEN PROPE… FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> TULSA    CM-2016-836  DL2, DRIVING UNDER SUSPENSION / DUS             FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> TULSA    CM-2022-1743 ABDOM, DOMESTIC ASSAULT AND BATTERY             FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> OKLAHOMA CM-2021-2486 DI1AG, AGGRAVATED DRIVING UNDER THE INFLUENCE … FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> TULSA    CM-2018-2200 DU4, POSSESSION OF CONTROLLED DRUG              TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> TULSA    CM-2019-3308 DI2D, DUI DRUGS                                 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> OKLAHOMA CM-2021-1954 WE5, CARRYING A FIREARM WHILE UNDER THE INFLUE… TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> OKLAHOMA CM-2016-2238 DU9, POSSESSION OF CDS - MARIJUANA              TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> OKLAHOMA CM-2021-1684 DU9II, UNLAWFUL POSSESSION OF CONTROLLED DRUG-… TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> TULSA    CM-2020-2985 DR3, UNLAWFUL POSSESSION OF DRUG PARAPHERNALIA  TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> OKLAHOMA CM-2016-1492 DU9IV, POSSESSION OF A CONTROLLED DANGEROUS SU… TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> OKLAHOMA CM-2020-3411 DU9II, UNLAWFUL POSSESSION OF CDS- METHAMPHETA… TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> OKLAHOMA CM-2018-2177 DU9II, POSSESSION OF A CDS- METHAMPHETAMINE     TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> OKLAHOMA CM-2020-530  DU9, UNLAWFUL POSSESSION OF CONTROLLED DRUG/MA… TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable name ¹​drug_charge</span></span></span></code></pre></div>
<p>It looks like our regex search was pretty successful! Although it may
raise some new questions: does driving under the influence count? Is
alcohol technically a “drug” in those cases, or is that different? What
about a count description that says “Carrying a firearm while under the
influence o drugs or alcohol”?</p>
<p>There are always going to be more questions like this, and you’ll
find them when you start digging in and double-checking your data. In
the end, we want to prioritize standardization and giving our client
whatever they actually want / need (even if we have to help them figure
out exactly what that is). For now, we’ll just accept the result as-is,
but at this point you might need to stop, re-assess some things, ask
other analysts / policy team their thoughts, follow up with a client,
etc.</p>
</div>
<div class="section level3">
<h3 id="summarizing-drug-charges-within-cases">Summarizing drug charges within cases<a class="anchor" aria-label="anchor" href="#summarizing-drug-charges-within-cases"></a>
</h3>
<p>We have one more wrangling task we need to figure out – we know what
counts as a drug <em>charge</em>, but what about a drug <em>case</em>?
For our purposes, we’ll say that a drug case means any case involving at
least one drug charge. Therefore, we’re going to make another version of
our <code>case_summary</code> dataframe, this time with a new variable
<code>drug_charges_present</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_summary_cleaned</span> <span class="op">&lt;-</span> <span class="va">charge_data_cleaned</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">district</span>, <span class="va">case_number</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># We want to keep the date_filed, so we'll use transmute() this time instead of summarize()</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span> </span>
<span>    date_filed <span class="op">=</span> <span class="va">date_filed</span>,</span>
<span>    <span class="co"># It will be helpful to have all the values of count_as_filed verbatim for double-checking</span></span>
<span>    list_all_charges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">count_as_filed</span>, collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span>,</span>
<span>    n_total_charges <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="co"># Count the number of rows where drug_charge == TRUE</span></span>
<span>    n_drug_charges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">drug_charge</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    drug_charges_present <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">n_drug_charges</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># transmute() leaves duplicate rows, so we'll drop those</span></span>
<span></span>
<span><span class="co"># Alternative approach:</span></span>
<span><span class="co"># case_summary_cleaned &lt;- charge_data_cleaned |&gt;</span></span>
<span><span class="co">#   group_by(district, case_number) |&gt;</span></span>
<span><span class="co">#   summarize( </span></span>
<span><span class="co">#     date_filed = unique(date_filed),</span></span>
<span><span class="co">#     list_all_charges = paste(count_as_filed, collapse = "; "),</span></span>
<span><span class="co">#     n_total_charges = n(),</span></span>
<span><span class="co">#     n_drug_charges = sum(drug_charge, na.rm = TRUE),</span></span>
<span><span class="co">#     drug_charges_present = if_else(n_drug_charges &gt; 0, TRUE, FALSE)</span></span>
<span><span class="co">#   ) |&gt;</span></span>
<span><span class="co">#   ungroup()</span></span></code></pre></div>
<p>We’ll also save a new dataframe that only includes the drug cases. We
can double check the result just like before, and see how many drug
cases we have total:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_summary_cleaned_drugs</span> <span class="op">&lt;-</span> <span class="va">case_summary_cleaned</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">drug_charges_present</span><span class="op">)</span></span>
<span></span>
<span><span class="va">case_summary_cleaned</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">drug_charges_present</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 7</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   drug_charges_present [2]</span></span></span>
<span><span class="co">#&gt;    district case_number  date_filed list_all_charges     n_tot…¹ n_dru…² drug_…³</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> TULSA    CM-2022-898  2022-03-21 BC, BOGUS CHECK UND…       1       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> TULSA    CM-2017-77   2017-01-06 OBS, OBSTRUCTING AN…       2       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> OKLAHOMA CM-2020-2149 2020-07-22 DI1M, DRIVING UNDER…       1       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> TULSA    CM-2016-4957 2016-09-28 ABDOM, ASSAULT AND …       1       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> OKLAHOMA CM-2020-3383 2020-11-05 OBS, OBSTRUCTING AN…       1       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> TULSA    CM-2022-1212 2022-04-13 DI1, DRIVING UNDER …       2       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> OKLAHOMA CM-2021-320  2021-02-01 DI1, DRIVING UNDER …       1       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> TULSA    CM-2020-3872 2020-11-04 DE0, OPERATE VEHICL…       3       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> TULSA    CM-2020-459  2020-01-30 ABDOM, ASSAULT AND …       1       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> TULSA    CM-2018-4607 2018-10-02 FORG, UTTERING FORG…       1       0 FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> TULSA    CM-2020-1770 2020-05-22 DR3, POSSESSION OF …       6       4 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> TULSA    CM-2016-5539 2016-11-03 OBS, OBSTRUCTING AN…       5       2 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> OKLAHOMA CM-2021-1728 2021-06-29 DU9II, UNLAWFUL POS…       1       1 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> TULSA    CM-2022-3479 2022-10-13 DU9I, UNLAWFUL POSS…       2       1 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> TULSA    CM-2019-3575 2019-08-08 DR3, POSSESSION OF …       2       2 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> TULSA    CM-2019-1186 2019-03-13 LP1, FAILURE TO PAY…       6       1 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> TULSA    CM-2016-628  2016-02-04 TU0, REQUIRED POSIT…       4       1 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> OKLAHOMA CM-2016-1610 2016-06-15 DU9, POSSESSION OF …       2       1 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> TULSA    CM-2022-2475 2022-07-22 DU8II, POSSESSION O…       1       1 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> OKLAHOMA CM-2020-1607 2020-06-15 DU9, UNLAWFUL POSSE…       2       2 TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​n_total_charges, ²​n_drug_charges,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ³​drug_charges_present</span></span></span>
<span></span>
<span><span class="co"># view(case_summary_cleaned)</span></span>
<span></span>
<span><span class="co"># What proportion of these CM cases feature a drug charge?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">case_summary_cleaned_drugs</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">case_summary_cleaned</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2604766</span></span></code></pre></div>
<p>Nice! Now we have some nice, clean datasets to visualize. This stage
of analysis is tough sometimes; it involves a lot of subjective
decision-making, a lot of making the most of messy data, and a lot of
double-checking of work. But even though we’re aiming for standardized
methods, it’s also one of the areas where we get to exercise a little
bit of creativity and come up with our own solutions to things, so feel
free to blaze your own path a little bit too!</p>
</div>
</div>
<div class="section level2">
<h2 id="step-4-visualizing-and-exporting-the-data">Step 4: Visualizing and exporting the data<a class="anchor" aria-label="anchor" href="#step-4-visualizing-and-exporting-the-data"></a>
</h2>
<p>To finish things off, we’re going to make ourselves a nice, pretty
graph showing how many of our drug cases were filed each month
throughout the timespan of our data. We’ll be using the
<code><a href="../reference/ojo_theme.html">ojo_theme()</a></code> and <code>ojo_colors()</code> functions from
<code>{ojodb}</code> to take care of most of the styling.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_summary_cleaned_drugs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    month_filed <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">date_filed</span>, <span class="st">"months"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">month_filed</span>, <span class="va">district</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">month_filed</span>,</span>
<span>             y <span class="op">=</span> <span class="va">n</span>,</span>
<span>             color <span class="op">=</span> <span class="va">district</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Usually we want to show the y-axis down to zero</span></span>
<span>  <span class="fu"><a href="../reference/ojo_theme.html">ojo_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ojo_color.html">ojo_color</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"CM cases involving at least one drug charge,"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Oklahoma and Tulsa county district courts, 2016-2022"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Month of case filing"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Total drug cases filed"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Source: Open Justice Oklahoma analysis</span></span>
<span><span class="st">    of Oklahoma State Court Network (OSCN.net) data."</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"District"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="vignette-pulling-data_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Looking good! If you’re curious about the increase seen around July
of 2017, you can read about why that happened <a href="https://okpolicy.org/sq-780-already-reshaping-oklahomas-justice-system/" class="external-link">here</a>.</p>
<p>We also frequently need to send out data in spreadsheet form. You’ll
typically want to export datasets using the <a href="https://readr.tidyverse.org" class="external-link">readr</a> package
in whatever format your client needs. A good default option is our old
friend the Comma Separated Values format, <code>.csv</code>. Here, we’d
do that with
<code>write_csv(case_summary_cleaned_drugs, "export-data.csv")</code>.
Exporting to the Microsoft Excel spreadsheet format <code>.xlsx</code>
will require the <a href="https://readxl.tidyverse.org" class="external-link">readxl</a> package.</p>
</div>
<div class="section level2">
<h2 id="step-5-review-and-deliver">Step 5: Review and deliver<a class="anchor" aria-label="anchor" href="#step-5-review-and-deliver"></a>
</h2>
<p>The last step in the process is to submit your work for a review.
Ideally, we should try to make sure everything we do has at least two
people (an analyst and a reviewer) look over it before we send it out to
a client or publish it. The review process should check every step in
the process, and include any needed discussions about the methodological
questions we talked about earlier.</p>
<p>We’re aiming to start doing reviews via Github. The process will
essentially be:</p>
<ol style="list-style-type: decimal">
<li>Open a pull request with all your code.</li>
<li>Request a reviewer on the pull request, and let them know you’re
ready for them to look it over via Slack, etc.</li>
<li>They should pull your code from GitHub and run it locally on their
machine, checking each step of the process along the way. Any notes,
changes, etc. should be included in their review on GitHub, so you can
see everything in one convenient place.</li>
<li>Once all edits have been addressed, we can merge the pull request
and we’ll have a nice finished product on our <code>main</code>
branch!</li>
</ol>
<p>From there, all you’ll have to do is write up an email (or whatever
delivery method is relevant) and send your data / visualizations out to
whoever needs them.</p>
<hr>
<p>If I wrote all of this correctly and you managed to follow along,
then congratulations to both of us! You’ve successfully learned how to
pull court data from the OJO database and use it to answer a research
question about our legal system. You’ll probably run into a lot of
things that aren’t covered in this vignette as you tackle new questions
and use new parts of our data, but hopefully this will be a useful
resource as you’re starting out.</p>
<p>Just remember – the data is very quirky, and there’s always going to
be stuff you don’t know and problems you aren’t sure how to solve.
Whether it’s a methodology issue, a coding issue, a “dealing with a
client” kind of issue, whenever you find yourself spinning your wheels,
please don’t hesitate to just ask! There’s a good chance OJO has been
there before, and if not, we’ll figure it out together. Thanks for
reading!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brancen Gregory, Ryan Gentzler, Andrew Bell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
