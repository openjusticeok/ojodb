---
title: "02 OJO Database and Summary Tables"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{02 OJO Database and Summary Tables}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  message = FALSE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5
)

library(tibble)
library(htmlTable)
library(ojodb)
```

The Open Justice Oklahoma database contains a wide range of data related to the state's criminal and civil justice systems gathered from a variety of sources, as well as supplemental data generated by OJO processes, such as identity-linking tables and geocoded addresses of evictions. It is a MySQL database hosted on Amazon Web Services, and it is currently accessible only by OJO staff and authorized partners through a database connection. We hope to release an API to allow public access to the data at some point.

## Data sources

The name of each table in the OJO database begins with a prefix signifying the source of the data, as outlined below.

### Raw data

Most data in the OJO database is stored in the same form it was collected. Since it is administrative data, it is not standardized and includes a healthy amount of typos and other errors. We try to preserve the raw data from every source in the database and layer our cleaning and standardizing methods on top of the raw data.

The table below describes the sources of raw data.

```{r, echo = FALSE}
htmlTable::htmlTable(tibble(Prefix = c("oscn_",
                                       "odcr_",
                                       "doc_",
                                       "dlm_"),
                            `Data related to` = c("District Courts (13 counties, including 6 largest by population)",
                                                  "District Courts (all courts not included in OSCN)",
                                                  "Prisons",
                                                  "Tulsa County Jail"),
                            Source = c("http://www.oscn.net",
                                       "https://www1.odcr.com/",
                                       "http://doc.ok.gov/odoc-public-inmate-data",
                                       "http://iic.tulsacounty.org/expInmateBookings")),
                     align = "l")
```

## OJO-generated data and methods

Tables with the prefix "ojo\_" relate to all aspects of the justice system. These tables store data generated by OJO methods and are used to store data that has been pre-processed, allowing the analyst to query data that is already summarized to the case level in a standardized way.

### Case types

What case types are and how to call the casetype_codes dataframe

Case-level summaries are stored in two tables, ojo_crim_cases for criminal cases and ojo_civ_cases for civil cases, depending on the case type. You can see a table of case type abbreviations and descriptions by running `view(casetype_codes)` when the ojodb package is loaded. 

That table looks like this:

```{r}
htmlTable::htmlTable(
  tibble(
    casetype_codes
  ),
  align = "l"
)
```

### ojo_crim_cases

The ojo_crim_cases table contains case summaries for felony ("CF") and misdemeanor ("CM") cases.

```{r, echo = FALSE}
htmlTable::htmlTable(
  tibble(
    read.delim("../data/ojo_crim_cases.csv", quote = "\"", sep = ",")
  ),
  align = "l"
)
```

### ojo_civ_cases

The ojo_civ_cases table contains case summaries for civil case types including small claims ("SC"), civil relief ("CJ" and "CS"), and others. A list of case types is available in a dataframe included in the ojodb package called `casetype_codes`.

```{r, echo = FALSE}
htmlTable::htmlTable(
  tibble(
    read.delim("data/ojo_civ_cases.csv", quote = "\"", sep = ",")
  ),
  align = "l"
)
```
